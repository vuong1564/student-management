<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
  <h1>Welcome, User</h1>
  <div class="tab-container">
    <!-- Tab Buttons -->
    <div class="tab-buttons">
      <button class="tab-button active" onclick="showTabUser('available-books')">Available Books</button>
      <button class="tab-button" onclick="showTabUser('borrowed-books')">Borrowed Books</button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="available-books">
      <h3>Books Available to Borrow</h3>
      <table id="available-books-table">
        <thead>
        <tr>
          <th>Title</th>
          <th>Author</th>
          <th>Category</th>
          <th>Published Year</th>
          <th>Price</th>
          <th>Available Quantity</th>
        </tr>
        </thead>
        <tbody id="available-books-list">
        <!-- Rows populated dynamically -->
        </tbody>
      </table>
    </div>

    <div class="tab-content" id="borrowed-books" style="display: none;">
      <h3>Your Borrowed Books</h3>
      <table id="borrowed-books-table">
        <thead>
        <tr>
          <th>Title</th>
          <th>Borrow Date</th>
          <th>Return Date</th>
        </tr>
        </thead>
        <tbody id="borrowed-books-list">
        <!-- Rows populated dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="scripts.js"></script>
</body>
</html>

<script>
  // Show Tab Logic
  function showTabUser(tabId) {
    // Ẩn tất cả các nội dung tab
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
      if (tab.id === tabId) {
        tab.style.display = 'block'; // Hiển thị tab được chọn
      } else {
        tab.style.display = 'none'; // Ẩn các tab khác
      }
    });

    // Loại bỏ lớp "active" trên tất cả các nút tab
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
      button.classList.remove('active');
    });

    // Thêm lớp "active" vào nút tab hiện tại
    const currentButton = document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`);
    if (currentButton) {
      currentButton.classList.add('active');
    }

    reloadCurrentTabUser(tabId);
  }

  // Reload current tab's data
  function reloadCurrentTabUser(tabId) {
    if (tabId === 'available-books') fetchAvailableBooks();
    if (tabId === 'borrowed-books') fetchBorrowedBooks();
  }

  // Fetch Available Books
  async function fetchAvailableBooks() {
    const API_URL = '/user/available-books';
    const availableBooksList = document.getElementById('available-books-list');
    availableBooksList.innerHTML = ''; // Clear table rows

    try {
      const response = await apiRequest(API_URL, 'GET');
      if (!response || response.length === 0) {
        availableBooksList.innerHTML = `<tr><td colspan="6">No books available.</td></tr>`;
        return;
      }

      response.forEach(book => {
        const row = document.createElement('tr');
        row.innerHTML = `
                <td>${book.title}</td>
                <td>${book.authorName}</td>
                <td>${book.categoryName}</td>
                <td>${book.publishedYear || ''}</td>
                <td>${book.price ? `$${book.price.toFixed(2)}` : ''}</td>
                <td>${book.availableQuantity}</td>
            `;
        availableBooksList.appendChild(row);
      });
    } catch (error) {
      console.error('Error fetching available books:', error);
    }
  }

  // Fetch Borrowed Books
  async function fetchBorrowedBooks() {
    const userId = localStorage.getItem('userId'); // Get user ID
    const API_URL = `/user/borrowed-books/${userId}`;
    const borrowedBooksList = document.getElementById('borrowed-books-list');
    borrowedBooksList.innerHTML = ''; // Clear table rows

    try {
      const response = await apiRequest(API_URL, 'GET');
      if (!response || response.length === 0) {
        borrowedBooksList.innerHTML = `<tr><td colspan="3">You have not borrowed any books.</td></tr>`;
        return;
      }

      response.forEach(book => {
        const row = document.createElement('tr');
        row.innerHTML = `
                <td>${book.bookTitle}</td>
                <td>${book.borrowDate}</td>
                <td>${book.returnDate || 'Not Returned'}</td>
            `;
        borrowedBooksList.appendChild(row);
      });
    } catch (error) {
      console.error('Error fetching borrowed books:', error);
    }
  }

</script>
